/**
 * app.config.js
 * Membaca environment variables dari process.env (atau .env saat lokal) dan
 * mengekspor konfigurasi Expo. Gunakan EAS secrets atau set EXPO_PUBLIC_*
 * environment variables sebelum build (tidak simpan secrets di repo).
 */

// Saat development lokal, muat .env jika ada
try {
  // eslint-disable-next-line @typescript-eslint/no-var-requires
  require('dotenv').config();
} catch (e) {
  // ignore
}

const SUPABASE_URL = process.env.EXPO_PUBLIC_SUPABASE_URL || '';
const SUPABASE_ANON_KEY = process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY || '';
const REVENUECAT_API_KEY = process.env.EXPO_PUBLIC_REVENUECAT_API_KEY || '';

module.exports = ({ config }) => ({
  ...config,
  expo: {
    ...config.expo,
    scheme: 'parentingai', // Add deep linking scheme
    owner: 'shinigami91', // EAS owner account
    extra: {
      SUPABASE_URL,
      SUPABASE_ANON_KEY,
      REVENUECAT_API_KEY,
      eas: {
        projectId: '37029595-3174-4cca-8d6c-81693e3a7716',
      },
    },
    // Plugins sudah didefinisikan di app.json, jangan override
    plugins: config.expo?.plugins ?? [],
    notification: {
      icon: './assets/icon.png',
      color: '#CDE9F9',
      androidMode: 'default',
      androidCollapsedTitle: 'Umai',
    },
    android: {
      ...config.expo?.android,
      package: 'com.razqashop.parentingai',
      softwareKeyboardLayoutMode: 'pan',
    },
    ios: {
      ...config.expo?.ios,
    },
  },
});
